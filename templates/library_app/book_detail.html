{% extends 'library_app/base.html' %}
{% block title %}{{ book.title }} — Library{% endblock %}
{% block content %}
  <div class="card">
    <div class="card-body">
      <h3>{{ book.title }}</h3>
      <h6 class="text-muted">by {{ book.author }} — {{ book.genre }}</h6>
      <p class="mt-3">{{ book.description }}</p>

      {% if book.is_borrowed %}
        <p><strong>Status:</strong> Borrowed by {{ book.borrowed_by.username }}</p>
        {% if active_record %}
          <p><small>Borrowed at: {{ active_record.borrowed_at }}</small></p>
        {% endif %}
      {% else %}
        <p><strong>Status:</strong> Available</p>
      {% endif %}

      <div class="mt-3">
        {% if user.is_authenticated %}
          {% if not book.is_borrowed %}
            <form method="post" action="{% url 'borrow_book' book.pk %}">{% csrf_token %}
              <button class="btn btn-primary">Borrow</button>
            </form>
          {% elif book.borrowed_by == user %}
            <form method="post" action="{% url 'return_book' book.pk %}">{% csrf_token %}
              <button class="btn btn-warning">Return Book</button>
            </form>
          {% else %}
            <button class="btn btn-secondary" disabled>Not available</button>
          {% endif %}
        {% else %}
          <p><a href="{% url 'login' %}">Log in</a> to borrow this book.</p>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}